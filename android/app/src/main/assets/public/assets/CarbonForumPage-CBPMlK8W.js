import{b as g,r as c,j as e}from"./vendor-CJAKlkPp.js";var v={};const j=g(v.SUPABASE_URL,v.SUPABASE_KEY);async function C(s){return j.from("carbon_forum_comments").insert([s])}async function S(s){return j.from("carbon_forum_comments").select("*").eq("postId",s).order("createdAt",{ascending:!0})}async function P(s){return j.from("carbon_forum_comments").delete().eq("id",s)}function N({postId:s,userId:l,onCommented:i}){const[n,o]=c.useState(""),[a,d]=c.useState(!1),[m,u]=c.useState(""),h=async r=>{r.preventDefault(),d(!0),u("");try{const{error:x}=await C({postId:s,userId:l,content:n,createdAt:new Date().toISOString()});x?u(x.message):(o(""),i&&i())}catch{u("Failed to post comment")}d(!1)};return e.jsxs("form",{onSubmit:h,className:"flex flex-col gap-2 mt-2",children:[e.jsx("textarea",{value:n,onChange:r=>o(r.target.value),placeholder:"Add a comment...",className:"textarea textarea-bordered w-full",required:!0}),m&&e.jsx("div",{className:"text-red-500 text-sm",children:m}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a||!n.trim(),children:a?"Posting...":"Post Comment"})]})}function E({postId:s,userId:l}){const[i,n]=c.useState([]),[o,a]=c.useState(!0),[d,m]=c.useState(""),u=async()=>{a(!0),m("");try{const{data:r,error:x}=await S(s);x?m(x.message):n(r||[])}catch{m("Failed to load comments")}a(!1)};c.useEffect(()=>{u()},[s]);const h=async r=>{await P(r),u()};return o?e.jsx("div",{children:"Loading comments..."}):d?e.jsx("div",{className:"text-red-500",children:d}):i.length?e.jsx("ul",{className:"divide-y mt-2",children:i.map(r=>e.jsxs("li",{className:"py-2",children:[e.jsx("div",{className:"text-sm",children:r.content}),e.jsx("div",{className:"text-xs text-gray-500",children:r.createdAt}),l===r.userId&&e.jsx("button",{className:"text-xs text-red-500 ml-2",onClick:()=>h(r.id),children:"Delete"})]},r.id))}):e.jsx("div",{children:"No comments yet."})}var y={};const p=g(y.SUPABASE_URL,y.SUPABASE_KEY);async function A(s){return p.from("carbon_forum_posts").insert([s])}async function k(s,l){return p.from("carbon_forum_posts").update(l).eq("id",s)}async function w(s){return p.from("carbon_forum_posts").delete().eq("id",s)}async function f(s){const l=p.from("carbon_forum_posts").select("*");return s?l.eq("type",s):l}const F=({userId:s})=>{const[l,i]=c.useState([]),[n,o]=c.useState({title:"",content:"",type:"",event_date:"",org_link:"",success_story:""}),[a,d]=c.useState(null),[m,u]=c.useState(!1);c.useEffect(()=>{f().then(({data:t})=>i(t||[]))},[]);const h=async()=>{await A({...n,user_id:s}),f().then(({data:t})=>i(t||[])),o({title:"",content:"",type:"",event_date:"",org_link:"",success_story:""})},r=t=>{d(t),u(!1)},x=async()=>{a&&(await k(a.id,a),f().then(({data:t})=>i(t||[])),u(!1))},_=async t=>{await w(t),f().then(({data:b})=>i(b||[])),d(null)};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Carbon Credit & Circular Economy Forum"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Create New Post"}),e.jsx("input",{type:"text",placeholder:"Title",value:n.title,onChange:t=>o({...n,title:t.target.value})}),e.jsx("textarea",{placeholder:"Content",value:n.content,onChange:t=>o({...n,content:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Type (event, opportunity, story)",value:n.type,onChange:t=>o({...n,type:t.target.value})}),e.jsx("input",{type:"date",placeholder:"Event Date",value:n.event_date,onChange:t=>o({...n,event_date:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Organization Link",value:n.org_link,onChange:t=>o({...n,org_link:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Success Story",value:n.success_story,onChange:t=>o({...n,success_story:t.target.value})}),e.jsx("button",{onClick:h,children:"Create Post"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Forum Posts"}),e.jsx("ul",{children:l.map(t=>e.jsxs("li",{children:[e.jsxs("button",{onClick:()=>r(t),children:[t.title," (",t.type,")"]}),e.jsx("button",{onClick:()=>_(t.id),children:"Delete"})]},t.id))})]}),a&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Post Details"}),m?e.jsxs("div",{children:[e.jsx("input",{type:"text",value:a.title,onChange:t=>d({...a,title:t.target.value})}),e.jsx("textarea",{value:a.content,onChange:t=>d({...a,content:t.target.value})}),e.jsx("button",{onClick:x,children:"Save"})]}):e.jsxs("div",{children:[e.jsx("h4",{children:a.title}),e.jsx("p",{children:a.content}),e.jsx("button",{onClick:()=>u(!0),children:"Edit"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold",children:"Comments"}),e.jsx(N,{postId:a.id,userId:s,onCommented:()=>{}}),e.jsx(E,{postId:a.id,userId:s})]})]})]})};export{F as CarbonForumPage};
