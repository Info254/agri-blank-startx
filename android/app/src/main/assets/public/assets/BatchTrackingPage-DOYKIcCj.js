import{b as f,r,j as e}from"./vendor-CJAKlkPp.js";var x={};const l=f(x.SUPABASE_URL,x.SUPABASE_KEY);async function S(n){return l.from("batch_tracking").insert([n])}async function j(n){return l.from("batch_tracking").select("*").eq("batch_id",n).single()}async function C(n,a){return l.from("batch_tracking").update(a).eq("batch_id",n)}async function y(n){const a=l.from("batch_tracking").select("*");return n?a.eq("farmer_id",n):a}async function N(n,a){const{data:c}=await j(n),i=(c==null?void 0:c.events)||[];return C(n,{events:[...i,a]})}async function g(n){const{data:a}=await j(n);return(a==null?void 0:a.events)||[]}const E=({farmerId:n})=>{const[a,c]=r.useState([]),[i,v]=r.useState(null),[s,o]=r.useState({product_type:"",quantity:0,origin:"",destination:""}),[h,d]=r.useState(""),[m,p]=r.useState([]);r.useEffect(()=>{y(n).then(({data:t})=>c(t||[]))},[n]);const b=async()=>{await S({...s,farmer_id:n}),y(n).then(({data:t})=>c(t||[])),o({product_type:"",quantity:0,origin:"",destination:""})},B=async t=>{v(t);const u=await g(t.batch_id);p(u)},_=async()=>{if(i){await N(i.batch_id,{text:h,date:new Date().toISOString()});const t=await g(i.batch_id);p(t),d("")}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Batch Tracking"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Create New Batch"}),e.jsx("input",{type:"text",placeholder:"Product Type",value:s.product_type,onChange:t=>o({...s,product_type:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Quantity",value:s.quantity,onChange:t=>o({...s,quantity:Number(t.target.value)})}),e.jsx("input",{type:"text",placeholder:"Origin",value:s.origin,onChange:t=>o({...s,origin:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Destination",value:s.destination,onChange:t=>o({...s,destination:t.target.value})}),e.jsx("button",{onClick:b,children:"Create Batch"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Your Batches"}),e.jsx("ul",{children:a.map(t=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>B(t),children:[t.product_type," (",t.status,")"]})},t.batch_id))})]}),i&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Batch Journey"}),e.jsx("ul",{children:m.map((t,u)=>e.jsxs("li",{children:[t.text," - ",t.date]},u))}),e.jsx("input",{type:"text",placeholder:"Add event",value:h,onChange:t=>d(t.target.value)}),e.jsx("button",{onClick:_,children:"Add Event"})]})]})};export{E as BatchTrackingPage};
